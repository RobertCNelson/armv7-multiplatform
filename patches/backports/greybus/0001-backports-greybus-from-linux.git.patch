From 99bb7177d345d8497ea137bf74ce0810c983494d Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Wed, 10 Jun 2020 10:56:34 -0500
Subject: [PATCH] backports: greybus: from: linux.git

Reference: v5.5.19
Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 drivers/greybus/connection.c   | 3 ---
 drivers/staging/greybus/uart.c | 4 ++--
 2 files changed, 2 insertions(+), 5 deletions(-)

diff --git a/drivers/greybus/connection.c b/drivers/greybus/connection.c
index fc8f57f97ce62..e3799a53a1930 100644
--- a/drivers/greybus/connection.c
+++ b/drivers/greybus/connection.c
@@ -361,9 +361,6 @@ static int gb_connection_hd_cport_quiesce(struct gb_connection *connection)
 	if (connection->mode_switch)
 		peer_space += sizeof(struct gb_operation_msg_hdr);
 
-	if (!hd->driver->cport_quiesce)
-		return 0;
-
 	ret = hd->driver->cport_quiesce(hd, connection->hd_cport_id,
 					peer_space,
 					GB_CONNECTION_CPORT_QUIESCE_TIMEOUT);
diff --git a/drivers/staging/greybus/uart.c b/drivers/staging/greybus/uart.c
index 4ffb334cd5cde..55c51143bb094 100644
--- a/drivers/staging/greybus/uart.c
+++ b/drivers/staging/greybus/uart.c
@@ -537,9 +537,9 @@ static void gb_tty_set_termios(struct tty_struct *tty,
 	}
 
 	if (C_CRTSCTS(tty) && C_BAUD(tty) != B0)
-		newline.flow_control = GB_SERIAL_AUTO_RTSCTS_EN;
+		newline.flow_control |= GB_SERIAL_AUTO_RTSCTS_EN;
 	else
-		newline.flow_control = 0;
+		newline.flow_control &= ~GB_SERIAL_AUTO_RTSCTS_EN;
 
 	if (memcmp(&gb_tty->line_coding, &newline, sizeof(newline))) {
 		memcpy(&gb_tty->line_coding, &newline, sizeof(newline));
-- 
2.26.2

