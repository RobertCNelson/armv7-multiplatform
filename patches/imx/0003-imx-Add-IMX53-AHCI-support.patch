From 41cc1967181a833c3c5af30682ea85dd01c28ff4 Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Tue, 22 Jan 2013 22:21:03 -0600
Subject: [PATCH 3/5] imx: Add IMX53 AHCI support

Adds device tree node and ahci_platform bits to make AHCI work on mx53 qsb board.

Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 arch/arm/boot/dts/imx53-qsb.dts |    4 ++++
 arch/arm/boot/dts/imx53.dtsi    |    8 ++++++++
 drivers/ata/ahci_platform.c     |    1 +
 3 files changed, 13 insertions(+)

diff --git a/arch/arm/boot/dts/imx53-qsb.dts b/arch/arm/boot/dts/imx53-qsb.dts
index 8f0e9ae..5e1d0cb 100644
--- a/arch/arm/boot/dts/imx53-qsb.dts
+++ b/arch/arm/boot/dts/imx53-qsb.dts
@@ -255,6 +255,10 @@
 	};
 };
 
+&ahci {
+	status = "okay";
+};
+
 &audmux {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_audmux_1>;
diff --git a/arch/arm/boot/dts/imx53.dtsi b/arch/arm/boot/dts/imx53.dtsi
index eb83aa0..fcb8758 100644
--- a/arch/arm/boot/dts/imx53.dtsi
+++ b/arch/arm/boot/dts/imx53.dtsi
@@ -782,5 +782,13 @@
 				status = "disabled";
 			};
 		};
+
+		ahci: ahci@0x10000000 { /* AHCI SATA */
+			compatible = "fsl,imx53-ahci";
+			reg = <0x10000000 0x4000>;
+			interrupts = <28>;
+			clocks = <&clks 124>;
+			status = "disabled";
+		};
 	};
 };
diff --git a/drivers/ata/ahci_platform.c b/drivers/ata/ahci_platform.c
index d324cdf..b01eeca 100644
--- a/drivers/ata/ahci_platform.c
+++ b/drivers/ata/ahci_platform.c
@@ -95,6 +95,7 @@ static struct scsi_host_template ahci_platform_sht = {
 
 static const struct of_device_id ahci_of_match[] = {
 	{ .compatible = "calxeda,hb-ahci",  .data = &ahci_devtype[AHCI],},
+	{ .compatible = "fsl,imx53-ahci",   .data = &ahci_devtype[IMX53_AHCI],},
 	{ .compatible = "fsl,imx6q-ahci",   .data = &ahci_devtype[IMX6Q_AHCI],},
 	{ .compatible = "snps,spear-ahci", },
 	{},
-- 
1.7.10.4

